name: Release Stable

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  find_version:
    runs-on: ubuntu-latest

    steps:
    - name: üöõ Checkout Code
      uses: actions/checkout@v2

    # - name: Set up Python
    #   uses: actions/setup-python@v2
    #   with:
    #     python-version: 3.7

    # - name: Get latest stable tag
    #   id: last_version
    #   run: |
    #     since_tag=`git tag --list 'v[0-9]*' | sort -V | tail -2 | head -1`
    #     due_tag=`git tag --list 'v[0-9]*' | sort -V | tail -1`
    #     echo $since_tag
    #     echo $due_tag
    #     echo ::set-output name=since_tag::$since_tag
    #     echo ::set-output name=due_tag::$due_tag

    - name: "‚úèÔ∏è Generate changelog"
      if: steps.version_type.outputs.type != 'skip'
      uses: docker://antonyurchenko/git-release:latest
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        DRAFT_RELEASE: "false"
        PRE_RELEASE: "false"
        CHANGELOG_FILE: "CHANGELOG.md"
        ALLOW_EMPTY_CHANGELOG: "false"
        ALLOW_TAG_PREFIX: "true"

    # - name: "‚úèÔ∏è Generate changelog"
    #   if: steps.version_type.outputs.type != 'skip'
    #   id: generate-last-changelog
    #   uses: heinrichreimer/github-changelog-generator-action@v2.2
    #   with:
    #     token: ${{ secrets.GITHUB_TOKEN }}
    #     breakingLabel: '### üí• Breaking'
    #     enhancementLabel: '### üöÄ Enhancements'
    #     bugsLabel: '### üêõ Bug fixes'
    #     deprecatedLabel: '### ‚ö†Ô∏è Deprecations'
    #     addSections: '{"documentation":{"prefix":"### üìñ Documentation","labels":["documentation"]},"tests":{"prefix":"### ‚úÖ Testing","labels":["tests"]}}'
    #     issues: false
    #     issuesWoLabels: false
    #     pullRequests: true
    #     prWoLabels: false
    #     author: false
    #     compareLink: true
    #     stripGeneratorNotice: true
    #     verbose: true
    #     excludeTagsRegex: "nightly/.+"
    #     releaseBranch: "main"
    #     sinceTag: "${{ steps.last_version.outputs.since_tag }}"
    #     stripHeaders: true

    - name: "Release"
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with: 
        body: ${{ steps.generate-last-changelog.outputs.changelog }}